import React, { useState, useEffect } from 'react';\nimport { Clock, Calendar, CheckCircle, XCircle, User, Phone, MapPin } from 'lucide-react';\nimport LoadingSpinner from '../../components/LoadingSpinner';\n\nconst StaffDashboard = () => {\n  const [stats, setStats] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [checkingIn, setCheckingIn] = useState(false);\n  const [checkingOut, setCheckingOut] = useState(false);\n  const [currentTime, setCurrentTime] = useState(new Date());\n\n  useEffect(() => {\n    fetchDashboardStats();\n    const timer = setInterval(() => setCurrentTime(new Date()), 1000);\n    return () => clearInterval(timer);\n  }, []);\n\n  const fetchDashboardStats = async () => {\n    try {\n      const token = localStorage.getItem('token');\n      const response = await fetch('/api/staff/dashboard/stats', {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        setStats(data.data);\n      }\n    } catch (error) {\n      console.error('Error fetching dashboard stats:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCheckIn = async () => {\n    setCheckingIn(true);\n    try {\n      const token = localStorage.getItem('token');\n      const response = await fetch('/api/staff/attendance/checkin', {\n        method: 'POST',\n        headers: {\n          Authorization: `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      \n      if (response.ok) {\n        fetchDashboardStats(); // Refresh stats\n        alert('Check-in successful!');\n      } else {\n        const error = await response.json();\n        alert(error.message || 'Check-in failed');\n      }\n    } catch (error) {\n      console.error('Check-in error:', error);\n      alert('Check-in failed');\n    } finally {\n      setCheckingIn(false);\n    }\n  };\n\n  const handleCheckOut = async () => {\n    setCheckingOut(true);\n    try {\n      const token = localStorage.getItem('token');\n      const response = await fetch('/api/staff/attendance/checkout', {\n        method: 'PUT',\n        headers: {\n          Authorization: `Bearer ${token}`,\n          'Content-Type': 'application/json'\n        }\n      });\n      \n      if (response.ok) {\n        fetchDashboardStats(); // Refresh stats\n        alert('Check-out successful!');\n      } else {\n        const error = await response.json();\n        alert(error.message || 'Check-out failed');\n      }\n    } catch (error) {\n      console.error('Check-out error:', error);\n      alert('Check-out failed');\n    } finally {\n      setCheckingOut(false);\n    }\n  };\n\n  if (loading) return <LoadingSpinner />;\n\n  return (\n    <div className=\"p-6\">\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">Staff Dashboard</h1>\n        <p className=\"text-gray-600\">Welcome! Manage your attendance and profile.</p>\n      </div>\n\n      {/* Current Time */}\n      <div className=\"mb-6 bg-blue-50 rounded-lg p-4 border border-blue-200\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center space-x-3\">\n            <Clock className=\"h-8 w-8 text-blue-600\" />\n            <div>\n              <h3 className=\"text-lg font-semibold text-blue-900\">Current Time</h3>\n              <p className=\"text-2xl font-mono text-blue-700\">\n                {currentTime.toLocaleTimeString()}\n              </p>\n            </div>\n          </div>\n          <p className=\"text-blue-600 font-medium\">\n            {currentTime.toLocaleDateString('en-US', { \n              weekday: 'long', \n              year: 'numeric', \n              month: 'long', \n              day: 'numeric' \n            })}\n          </p>\n        </div>\n      </div>\n\n      {/* Attendance Actions */}\n      <div className=\"grid md:grid-cols-2 gap-6 mb-8\">\n        <div className=\"bg-green-50 rounded-lg p-6 border border-green-200\">\n          <h3 className=\"text-lg font-semibold text-green-900 mb-4\">Check In</h3>\n          <p className=\"text-green-700 mb-4\">\n            Mark your arrival for today's shift\n          </p>\n          <button\n            onClick={handleCheckIn}\n            disabled={checkingIn || stats?.todayStatus === 'present'}\n            className=\"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center space-x-2\"\n          >\n            {checkingIn ? (\n              <><div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"></div><span>Checking In...</span></>\n            ) : (\n              <><CheckCircle className=\"h-5 w-5\" /><span>Check In</span></>\n            )}\n          </button>\n          {stats?.todayStatus === 'present' && (\n            <p className=\"text-green-600 mt-2 text-sm\">\n              ✓ Already checked in at {stats?.checkIn}\n            </p>\n          )}\n        </div>\n\n        <div className=\"bg-red-50 rounded-lg p-6 border border-red-200\">\n          <h3 className=\"text-lg font-semibold text-red-900 mb-4\">Check Out</h3>\n          <p className=\"text-red-700 mb-4\">\n            Mark your departure for today's shift\n          </p>\n          <button\n            onClick={handleCheckOut}\n            disabled={checkingOut || stats?.todayStatus !== 'present' || stats?.checkOut}\n            className=\"bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center space-x-2\"\n          >\n            {checkingOut ? (\n              <><div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin\"></div><span>Checking Out...</span></>\n            ) : (\n              <><XCircle className=\"h-5 w-5\" /><span>Check Out</span></>\n            )}\n          </button>\n          {stats?.checkOut && (\n            <p className=\"text-red-600 mt-2 text-sm\">\n              ✓ Checked out at {stats?.checkOut}\n            </p>\n          )}\n        </div>\n      </div>\n\n      {/* Stats Cards */}\n      <div className=\"grid md:grid-cols-3 gap-6 mb-8\">\n        <div className=\"bg-white rounded-lg shadow-sm p-6 border\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-600 uppercase tracking-wide\">This Month</p>\n              <p className=\"text-2xl font-bold text-gray-900\">{stats?.totalWorkingDays || 0}</p>\n              <p className=\"text-sm text-gray-500\">Working Days</p>\n            </div>\n            <Calendar className=\"h-12 w-12 text-blue-500\" />\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-lg shadow-sm p-6 border\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-600 uppercase tracking-wide\">Present Days</p>\n              <p className=\"text-2xl font-bold text-green-600\">{stats?.presentDays || 0}</p>\n              <p className=\"text-sm text-gray-500\">This Month</p>\n            </div>\n            <CheckCircle className=\"h-12 w-12 text-green-500\" />\n          </div>\n        </div>\n\n        <div className=\"bg-white rounded-lg shadow-sm p-6 border\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-600 uppercase tracking-wide\">Absent Days</p>\n              <p className=\"text-2xl font-bold text-red-600\">{stats?.absentDays || 0}</p>\n              <p className=\"text-sm text-gray-500\">This Month</p>\n            </div>\n            <XCircle className=\"h-12 w-12 text-red-500\" />\n          </div>\n        </div>\n      </div>\n\n      {/* Quick Actions */}\n      <div className=\"bg-white rounded-lg shadow-sm border\">\n        <div className=\"px-6 py-4 border-b\">\n          <h2 className=\"text-xl font-semibold text-gray-900\">Quick Actions</h2>\n        </div>\n        <div className=\"p-6\">\n          <div className=\"grid md:grid-cols-2 gap-4\">\n            <a\n              href=\"/staff/profile\"\n              className=\"flex items-center space-x-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors\"\n            >\n              <User className=\"h-6 w-6 text-gray-600\" />\n              <div>\n                <h3 className=\"font-medium text-gray-900\">View Profile</h3>\n                <p className=\"text-sm text-gray-500\">Update your personal information</p>\n              </div>\n            </a>\n            \n            <a\n              href=\"/staff/attendance/history\"\n              className=\"flex items-center space-x-3 p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors\"\n            >\n              <Calendar className=\"h-6 w-6 text-gray-600\" />\n              <div>\n                <h3 className=\"font-medium text-gray-900\">Attendance History</h3>\n                <p className=\"text-sm text-gray-500\">View your attendance records</p>\n              </div>\n            </a>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default StaffDashboard;